# Expense automation subsystem analysis

## 1. 서브시스템 구조 (Subsystem structure)

### 1.1 사용자 인터랙션 계층
- **역할**: 파일 업로드, 템플릿 검토/수정, 자동 입력 실행, 결과 확인.
- **주요 컴포넌트**: 크롬 확장프로그램 UI(팝업), 파일 선택 UI, 미리보기 UI.

### 1.2 데이터 처리 계층
- **역할**: 원본 엑셀 파싱, 매핑 규칙 적용, 템플릿 생성, 템플릿 파싱.
- **주요 컴포넌트**: 원본 파서, 매핑 엔진, 템플릿 생성기, 템플릿 검증.

### 1.3 자동 입력 계층
- **역할**: 비용처리 사이트 UI에 자동 입력, 실패 항목 스킵, 자동 저장.
- **주요 컴포넌트**: PeopleSoft DOM 접근기, 입력 시퀀서, 오류 처리기, 저장 트리거.

### 1.4 외부 시스템
- **비용처리 사이트(PeopleSoft)**: 입력 폼, 세션 타임아웃, Save for later 버튼.
- **엑셀 파일(원본/템플릿)**: 입력 데이터와 변환 산출물.

## 2. 인터페이스 관계 (Interface relationships)

### 2.1 사용자 ↔ 확장프로그램 UI
- **입력**: 원본 승인내역 엑셀 업로드, 템플릿 업로드, 자동 입력 시작 클릭.
- **출력**: 매핑 결과 미리보기, 템플릿 다운로드 링크/파일.

### 2.2 확장프로그램 ↔ 엑셀(원본)
- **입력**: 원본 승인내역 컬럼(이용일, 사용처, 업종, 승인시간, 이용금액 등).
- **출력**: 내부 표준 모델(Expense Item 리스트).

### 2.3 확장프로그램 ↔ 엑셀(템플릿)
- **입력**: 사용자가 수정한 Expense Util 템플릿.
- **출력**: 자동 입력에 사용될 표준 모델(Expense Item 리스트).

### 2.4 확장프로그램 ↔ 비용처리 사이트
- **입력**: Expense Item 데이터를 PeopleSoft 입력 필드에 반영.
- **출력**: 입력 완료 후 Save for later 버튼 클릭.
- **특이사항**: 실패 항목은 스킵하고 나머지 입력을 계속 진행.

## 3. 서브시스템 기능 흐름 (Subsystem functional flow)

### 3.1 원본 → 템플릿 생성 흐름
1. 사용자가 원본 승인내역 파일을 업로드한다.
2. 원본 파서가 컬럼을 읽고 표준 모델을 생성한다.
3. 매핑 엔진이 사용처/업종/금액/시간대 규칙으로 Expense Type을 결정한다.
4. 템플릿 생성기가 Expense Util 템플릿 파일을 만든다.
5. 사용자는 템플릿을 다운로드하여 수정한다.

### 3.2 템플릿 → 자동 입력 흐름
1. 사용자가 수정된 템플릿을 업로드한다.
2. 템플릿 파서가 항목을 표준 모델로 변환한다.
3. 자동 입력 시퀀서가 PeopleSoft UI에 순차 입력한다.
4. 실패 항목은 스킵하고 나머지 항목 입력을 완료한다.
5. 입력 완료 후 Save for later를 자동 클릭한다.

### 3.3 세션 보호/자동 저장 흐름
1. 입력이 길어질 경우 세션 만료 위험을 감지한다.
2. 일정 시간 이상 무응답 상태에서도 Save for later를 수행한다.
3. 저장 실패 시 사용자에게 경고한다.

## 4. 고려사항
- UI 변경에 따른 DOM 식별자 변경 시 자동 입력 실패 가능.
- 매핑 규칙 갱신 필요 시 JSON 설정 업데이트.
- 저장 버튼 탐색 실패 대비 fallback 전략 필요.
