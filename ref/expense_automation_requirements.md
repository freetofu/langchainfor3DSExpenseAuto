# Expense automation requirements (draft)

## 1. 문제 정의 (Problem statement)
- 비용처리 사이트는 응답이 느리고, 수동 입력해야 할 항목이 많아 업무 시간이 낭비됨.
- 입력 중 사이트 세션이 종료되면(로그아웃) 작성 내용이 삭제되는 위험이 있음.
- 비용처리 자동화를 통해 처리 시간을 크게 줄이고, 실수를 최소화하고자 함.
- 기존에 `Expense Util` 크롬 확장프로그램(엑셀 템플릿 + 자동 입력)이 존재하며, 재사용 또는 재구축 모두 가능함.

## 2. 이해관계자 요구사항 (Stakeholder needs)
- **사용자(실무자):** 원본 카드 승인내역 엑셀을 바로 넣고 자동으로 템플릿/입력까지 진행되길 원함.
- **관리자(재무/회계):** Expense Type 분류가 정확하고 일관되길 원함.
- **보안/IT:** 민감한 결제 데이터가 안전하게 처리되길 원함.

## 3. 목표 (Goals)
- 원본 승인내역 → 템플릿 초안 → 사용자 검토/수정 → 자동 입력까지 단계를 자동화.
- 입력 완료 후 **자동 저장/제출**을 수행하여 세션 만료로 인한 데이터 손실을 방지.
- 자동화 과정에서 사용자가 이해할 수 있는 **검토/경고 UI** 제공.

## 4. 범위 (Scope)
### 포함 (In scope)
1. 원본 파일에서 **Expense Type 자동 매핑** (사용처/금액대/시간대/업종 기준).
2. 사용자 검토/수정 단계 제공 (미리보기/편집 또는 템플릿 재다운로드 방식).
3. 템플릿 기반 자동 입력 기능 유지 및 개선.
4. `hosp.` 포함 Expense Type의 참석자 입력 필요성 강조 표시.
5. 자동 입력 완료 후 **자동 저장/제출** 기능 추가.

### 제외 (Out of scope)
- 사이트 구조가 크게 바뀐 경우의 장기 유지보수까지 포함한 완전 자동 적응.
- PeopleSoft API 제공 여부에 따른 백엔드 통합(별도 협의 필요).

## 5. 기능 요구사항 (Functional requirements)
### 5.1 원본 엑셀 처리
- 원본 승인내역 엑셀의 컬럼을 인식하여 내부 표준 구조로 변환.
- Expense Type 매핑 규칙은 설정 파일(JSON 등)로 관리.
- 매핑 실패 시 기본값(Unknown 등) 설정 및 사용자 확인 필요.
- 택시 항목은 승인시간이 10초 이내로 연속된 결제는 하나로 통합(금액 합산)한다.

### 5.2 사용자 검토/수정
- 자동 매핑 결과를 보여주는 미리보기 UI 제공.
- 사용자가 항목을 수정하거나 재분류할 수 있는 기능 제공.

### 5.3 자동 입력
- PeopleSoft 입력 화면에 템플릿 기반 자동 입력 수행.
- 입력 실패 시 재시도 또는 실패 항목만 다시 실행할 수 있어야 함.

### 5.4 `hosp.` 항목 강조
- Expense Type에 `hosp.`가 포함되면 참석자 입력 필요성을 강조 표시.

### 5.5 자동 저장/제출
- 입력 완료 후 지정된 버튼(저장/제출)을 자동 클릭.
- 일정 시간 사용자 반응이 없을 경우 자동 저장을 수행.
- 저장 실패 시 사용자에게 즉시 경고.

## 6. 비기능 요구사항 (Non-functional requirements)
- **성능:** 대량 건 입력 시 처리 속도가 안정적이어야 함.
- **안정성:** 네트워크 지연 상황에서도 오류 없이 재시도 가능해야 함.
- **보안:** 카드 승인내역 데이터는 로컬에서 처리하고 외부 전송을 최소화.
- **사용성:** 사용자는 입력 진행 상태 및 오류 원인을 쉽게 확인할 수 있어야 함.

## 7. 리스크 및 고려사항 (Risks & considerations)
- PeopleSoft UI 변경 시 자동 입력이 실패할 수 있음.
- 세션 타임아웃으로 인해 입력 중간에 데이터가 손실될 위험.
- Expense Type 매핑 규칙이 부정확하면 재무 규정 위반 가능.
- 해외결제/부분취소/할부 등 복잡 케이스 처리 필요.

## 8. 확인이 필요한 사항 (Open questions)
1. Expense Type 리스트 및 매핑 기준(사용처/업종/금액대/시간대) 상세 규칙: 제공된 이미지 기준으로 매핑 규칙을 고정 적용.
2. Payment Type / Billing Type / Currency 값은 고정인지, 조건부인지: 고정값 사용.
3. 자동 저장/제출 버튼 위치 및 정확한 동작 플로우: 자동 저장만 수행. 버튼은 `Save for later`이며, 정확한 DOM 식별자/텍스트 확인 필요.
4. 템플릿 입력 최대 건수 제한(현재 50건 제한 유지 여부): 제한 없음.
5. 실패 항목 재처리 방식(전체 재실행 vs 실패 항목만): 실패 항목만 재처리하고, 중간 실패가 있더라도 전체 프로세스는 계속 진행.

## 9. 성공 기준 (Success criteria)
- 자동화로 인해 비용처리 시간이 최소 70% 이상 단축됨.
- 자동 입력 중 실패율이 5% 미만.
- 세션 만료로 인한 데이터 손실이 발생하지 않음.

## 10. 사용자 시나리오 (User scenarios)
### 시나리오 1~2: 원본 승인내역 → 템플릿 검토/수정 → 자동 입력
1. 사용자는 크롬을 켜고 크롬 확장 프로그램을 연다.
2. 원본 승인내역 엑셀 파일을 확장프로그램에 첨부한다.
3. 확장프로그램은 매핑 규칙(사용처/업종/금액/시간대)에 따라 Expense Type을 자동 분류한다.
4. 확장프로그램은 자동 분류 결과로 기존 Expense Util 템플릿을 생성한다.
5. 사용자는 생성된 템플릿을 다운로드받아 검토하거나 부족한 내용을 수정한다.
6. 사용자는 비용처리 사이트에 접속하고 로그인한 후 크롬 확장 프로그램에 수정된 템플릿을 첨부한다.
7. 자동 입력을 시작하면 확장프로그램이 항목을 순차 입력한다.
8. 실패 항목은 건너뛰며 입력을 완료한다.
9. 마지막에 `Save for later`를 자동 클릭해 저장한다.

### 시나리오 3: 세션 만료 방지 자동 저장
1. 입력 항목이 많아 처리 시간이 길어지는 경우에도 자동 입력은 진행된다.
2. 일정 시간 이상 사용자 입력이 없더라도 자동 저장이 수행되어 입력 데이터가 삭제되지 않는다.
