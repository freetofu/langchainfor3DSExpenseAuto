# Expense automation system context

## 시스템 범위
비용처리 자동화 시스템은 **사용자**, **크롬 확장프로그램**, **비용처리 사이트(PeopleSoft)**, **엑셀(원본/템플릿)** 간의 데이터 흐름을 중심으로 구성된다. 이 문서는 각 시스템 간 상호작용과 주고받는 데이터를 정리한다.

## 주요 시스템
1. **사용자(User)**
   - 원본 승인내역 파일 업로드
   - 템플릿 다운로드 및 수정
   - 템플릿 업로드 및 자동 입력 실행

2. **크롬 확장프로그램(Expense Util 기반)**
   - 원본 승인내역 파싱 및 매핑 규칙 적용
   - Expense Util 템플릿 생성
   - 템플릿 기반 자동 입력 실행
   - `Save for later` 자동 저장

3. **비용처리 사이트(https://dsxfinance.dsone.3ds.com)**
   - PeopleSoft UI 기반 입력 폼
   - 세션 타임아웃 존재
   - 저장 버튼(`Save for later`) 제공

4. **엑셀 파일**
   - **원본 승인내역 엑셀**: 카드 승인내역/사용처/금액/시간/업종 등 원본 데이터
   - **Expense Util 템플릿 엑셀**: Expense Type, 결제유형, 통화 등이 입력된 자동 입력용 템플릿

## 시스템 간 데이터 흐름
### 1) 사용자 → 확장프로그램 (원본 승인내역 업로드)
- **입력 데이터**: 원본 승인내역 엑셀
- **주요 필드**: 이용일, 가맹점명, 사용처, 이용금액, 승인시간, 가맹점업종명/코드
- **목적**: Expense Type 자동 매핑용 기초 데이터 제공

### 2) 확장프로그램 → 사용자 (템플릿 생성/다운로드)
- **출력 데이터**: Expense Util 템플릿 엑셀
- **포함 필드**: Expense Type, 날짜, 금액, 설명, 통화, Payment Type, Billing Type
- **특이점**: `hosp.` 항목은 참석자 입력 필요성 표시

### 3) 사용자 → 확장프로그램 (템플릿 업로드)
- **입력 데이터**: 수정된 Expense Util 템플릿 엑셀
- **목적**: 최종 검토 완료된 데이터를 자동 입력에 사용

### 4) 확장프로그램 → 비용처리 사이트 (자동 입력)
- **전송 데이터**: 템플릿 기반 입력 값
- **입력 필드**:
  - 날짜(TRANS_DATE)
  - Expense Type
  - 설명(DESCR)
  - 금액(TRANS_AMT1)
  - 통화(EX_SHEET_LINE_TXN_CURRENCY_CD)
  - Payment Type(PAYMENT_TYPE)
  - Billing Type(EX_SHEET_LINE_BILL_CODE_EX)
  - 참석자 정보(필요 시)
- **동작 방식**: PeopleSoft UI 폼에 순차 입력
- **실패 처리**: 실패 항목은 건너뛰고 계속 진행

### 5) 확장프로그램 → 비용처리 사이트 (자동 저장)
- **동작**: 입력 완료 후 `Save for later` 자동 클릭
- **목적**: 세션 만료로 인한 데이터 손실 방지

## 데이터 맵 요약
| 흐름 | 출처 → 대상 | 데이터 | 비고 |
| --- | --- | --- | --- |
| 원본 업로드 | 사용자 → 확장프로그램 | 원본 승인내역 엑셀 | 매핑 기준 데이터 |
| 템플릿 생성 | 확장프로그램 → 사용자 | Expense Util 템플릿 | 다운로드/수정 |
| 템플릿 업로드 | 사용자 → 확장프로그램 | 수정된 템플릿 | 자동 입력 기준 |
| 자동 입력 | 확장프로그램 → 비용처리 사이트 | 입력 필드 값 | 실패 항목 제외 |
| 자동 저장 | 확장프로그램 → 비용처리 사이트 | Save for later 클릭 | 세션 만료 방지 |

## 고려사항
- PeopleSoft UI 변경 시 입력 필드/버튼 선택자가 달라질 수 있음.
- 원본 승인내역의 컬럼명이 바뀌면 매핑 규칙을 업데이트해야 함.
- 세션 타임아웃에 대비한 주기적 저장 필요.
